```{r}

library(tidyverse)
library(broom)
```

How many people had cancer?

# https://ehsanx.github.io/TMLEworkshop/rhc-data-description.html

```{r}

rhc_clean |> 
  count(ca,sex)


```

```{r}
rhc_clean



```

## PCA analysis

```{r}
rhc_clean

rhc_for_pca <- rhc_clean |>
  mutate(swang1 = case_when(
                            swang1 == "RHC" ~ 1,
                            swang1 == "No RHC" ~ 0)) |> 
  select(where(is.numeric)) |> 
  select(c(death, swang1,age,edu,meanbp1,resp1,hrt1,crea1,pot1,surv2md1))

pca_fit <- rhc_for_pca |>
  prcomp(scale = TRUE)
  

#Things to change:
#death, swang1,age,edu,cardiohx,chfhx,dementhx,renalhx,meanbp1,resp1,hrt1,crea1,pot1

```

```{r}

pca_fit |> 
  augment(rhc_for_pca) %>% # add original dataset back in
  ggplot(aes(.fittedPC1, .fittedPC2,color = death)) + 
  geom_point(size = 1.5)


```

```{r}
pca_fit %>%
  tidy(matrix = "eigenvalues")


pca_fit %>%
  tidy(matrix = "eigenvalues") %>%
  ggplot(aes(PC, percent)) +
  geom_col(fill = "#56B4E9", alpha = 0.8) +
  scale_x_continuous(breaks = 1:9) +
  scale_y_continuous(
    labels = scales::percent_format(),
    expand = expansion(mult = c(0, 0.01))
  )
```

```{r}
pca_fit %>%
  tidy(matrix = "rotation")

```

```{r}
arrow_style <- arrow(
  angle = 20, ends = "first", type = "closed", length = grid::unit(8, "pt")
)

# plot rotation matrix
pca_fit %>%
  tidy(matrix = "rotation") %>%
  pivot_wider(names_from = "PC", names_prefix = "PC", values_from = "value") %>%
  ggplot(aes(PC1, PC2)) +
  geom_segment(xend = 0, yend = 0, arrow = arrow_style) +
  geom_text(
    aes(label = column),
    hjust = 1, nudge_x = -0.02, 
    color = "#904C2F"
  ) +
  xlim(-1.25, .5) + ylim(-.5, 1) +
  coord_fixed() # fix aspect ratio to 1:1

```

```{r}
pca_fit %>%
  tidy(matrix = "eigenvalues")
```

```{r}
rhc_clean
```

```{r}

rhc_clean |> 
  ggplot(aes(x = factor(swang1), fill = factor(swang1))) +
  geom_bar() +
  facet_wrap(~cat1, scales = "free_y") +
  labs(title = "How many people got RHC for each disease",
       x = "RHC",
       y = "Count")

```

```{r}
rhc_clean |> 
  mutate(death = case_when(
    death == 0 ~ "Survived",
    death == 1 ~ "Dead"
  )) |> 
  ggplot(aes(x = factor(swang1), fill = factor(swang1))) +
  geom_bar() +
  facet_wrap(~death, scales = "free_y") +
  labs(title = "How many survivers/deceased had RHC performed",
       x = "RHC",
       y = "Counts",
       legend.title = element_text(colour = "steelblue"))

```

```{r}
rhc_clean |> 
  mutate(days_survived = )
```

```{r}
rhc_clean
```

```{r}
rhc_clean |> select(sadmdte) |>
  arrange(sadmdte) |>
  sample_n(size = 500) |> 
  print(n = 500)
```
