# Libraries 
```{r}
library(tidyverse)
library(base)
library(patchwork)
library(scales)
library(ggridges)
library(patchwork)
library(ggseqlogo)
library(dplyr)
library(table1)
```

```{r}
colnames(rhc_clean)
```

The variables that we found to be interesting to analyze from a socioeconomic perspective are: 
```{r}
rhc_clean |> select(age, sex, edu, race, income, ninsclas)
```

For all the variables of interest, we focused on plotting the death distribution of patients and if they had been applied an RHC.



## Age

Following plot provides insights into the mortality rates across different ages.
```{r}
# Death in different ages
rhc_clean |>
  ggplot(aes(x = age, 
             fill=factor(death))) +
  geom_bar() +
  labs(title = "Death in different ages",
       x = "Age",
       y = "Number of patients") +
  scale_fill_manual(name= "Death", values = c("0" = "blue", "1" = "red")) +
  theme_minimal()

```
We create a new variable called "age_group" based on the "age" variable, allowing for the grouping of individuals into specific age ranges.
```{r}
rhc_clean <- rhc_clean |> 
  mutate(age_group = cut(age, breaks = c(0, 10, 20, 30, 40, 50, 60, 70, 80, 90, Inf), 
                         labels = c("<10", "10-20", "20-30", "30-40", "40-50", "50-60", "60-70", "70-80", "80-90", "> 90")))

```
Following plot provides insights into the mortality rates across different age groups.
```{r}
# Death in different group ages
rhc_clean |>
  ggplot(aes(x = age_group, 
             fill=factor(death))) +
  geom_bar() +
  labs(title = "Death in different ages",
       x = "Age",
       y = "Number of patients") +
  scale_fill_manual(name= "Death", values = c("0" = "blue", "1" = "red")) +
  theme_minimal()
```

The following chunk is a representation of the percentage of deaths by age group.
```{r}
## Percentage of death by age
rhc_clean |> 
  group_by(age_group, death) |> 
  summarize(count = n()) |> 
  group_by(age_group) |> 
  mutate(percent = count / sum(count) * 100) |> 
  ungroup() |> 
  filter(death == 1) |> 
  select(age_group, percent)
```
Several observations can be made. Firstly, it becomes apparent that mortality rates increase with advancing age. This finding aligns with existing knowledge that older individuals generally have a higher risk of experiencing adverse health outcomes. Secondly, the plot demonstrates that the number of deaths is relatively higher in certain age brackets, indicating the presence of age-specific vulnerabilities. Further research would be needed to fully understand the underlying reasons for these variations.


Following plot provides insights into the RHC appliance rates across different age groups.
```{r}
# Count of RHC by age
rhc_clean |> 
  ggplot(aes(x = age_group, 
             fill = as.factor(swang1))) +
  geom_bar() +
  labs(title = "Distribution of Age by RHC Status",
       x = "Age",
       y = "Count",
       fill = "RHC Status") +
  scale_fill_manual(name= "RHC Status", values = c("No RHC" = "blue", "RHC" = "red")) +
  theme_minimal()
  
```

The following chunk shows the corresponding percentage of RHC procedures for each age group.
```{r}
## Percentage of RHC by age_group
rhc_clean |> 
  group_by(age_group, swang1) |> 
  summarize(count = n()) |> 
  group_by(age_group) |> 
  mutate(percent = count / sum(count) * 100) |> 
  ungroup() |> 
  filter(swang1 == "RHC") |> 
  select(age_group, percent)
```
This results suggests that middle-aged patients (40-50 and 60-70 age groups) may have higher rates of RHC procedures, potentially due to specific cardiac conditions or clinical indications. Conversely, patients (10-20 age group) and older (> 90 age group) may have lower rates of RHC procedures, indicating a different clinical approach or lower prevalence of conditions requiring RHC. Further research would be needed to understand the underlying reasons for these variations and fully evaluate the appropriateness of RHC procedures.


## Gender

Following plot provides insights into the mortality rates across different genders.
```{r}
# Death females vs. males
rhc_clean |>
  ggplot(aes(x = sex,
             fill=factor(death))) +
  geom_bar() +
  labs(title = "Death females vs. males",
       x = "Gender",
       y = "Number of patients") +
  scale_fill_manual(name= "Death", values = c("0" = "blue", "1" = "red")) +
  theme_minimal()
```


The following chunk is a representation of the percentage of deaths by gender.
```{r}
# Percentage of death by gender
rhc_clean |> 
  group_by(sex, death) |> 
  summarize(count = n()) |> 
  group_by(sex) |> 
  mutate(percent = count / sum(count) * 100) |> 
  ungroup() |> 
  filter(death == 1) |> 
  select(sex, percent)
```
This results suggest that there may be a slight difference in mortality rates between females and males, with males having a slightly higher percentage of deaths. However, it is important to note that the difference is relatively small and may not be statistically significant. Further research would be needed to fully understand and check the underlying reasons for these variations.



Following plot provides insights into the RHC appliance rates across different genders.
```{r}
# Count of RHC by gender
rhc_clean |> 
  ggplot(aes(x = sex, 
             fill = as.factor(swang1))) +
  geom_bar() +
  labs(title = "Distribution of Gender by RHC Status",
       x = "Gender",
       y = "Number of patients",
       fill = "RHC Status") +
  scale_fill_manual(name= "RHC Status", values = c("No RHC" = "blue", "RHC" = "red")) +
  theme_minimal()
```

The following chunk shows the corresponding percentage of RHC procedures for each gender.
```{r}
## Percentage of RHC by gender
rhc_clean |> 
  group_by(sex, swang1) |> 
  summarize(count = n()) |> 
  group_by(sex) |> 
  mutate(percent = count / sum(count) * 100) |> 
  ungroup() |> 
  filter(swang1 == "RHC") |> 
  select(sex, percent)
```
This suggest a potential difference in RHC utilization between females and males, with males having a slightly higher percentage of RHC procedures. Further research would be needed to fully understand and check the underlying reasons for these variations. 


## Race

Following plot provides insights into the mortality rates across different races.
```{r}
#Death by race
rhc_clean |> 
  ggplot(aes(x = race, 
             fill=factor(death))) +
  geom_bar() +
  labs(title = "Death in race",
       x = "Race",
       y = "Count",
       fill = "Death") +
  scale_fill_manual(name= "Death", values = c("0" = "blue", "1" = "red")) +
  theme_minimal()
```

The following chunk is a representation of the percentage of deaths by race.
```{r}
# Percentage of death by race
rhc_clean |> 
  group_by(race, death) |> 
  summarize(count = n()) |> 
  group_by(race) |> 
  mutate(percent = count / sum(count) * 100) |> 
  ungroup() |> 
  filter(death == 1) |> 
  select(race, percent)
```
This suggest a potential variation in mortality rates among different racial groups, with the white population having a slightly higher percentage of deaths. Further research would be needed to fully understand and check the underlying reasons for these variations. 


Following plot provides insights into the RHC appliance rates across different race.
```{r}
rhc_clean |> 
  ggplot(aes(x = race, 
             fill = as.factor(swang1))) +
  geom_bar() +
  labs(title = "Distribution of Race by RHC Status",
       x = "Race",
       y = "Number of patients",
       fill = "RHC Status") +
  scale_fill_manual(name= "RHC Status", values = c("No RHC" = "blue", "RHC" = "red")) +
  theme_minimal()
```

The following chunk shows the corresponding percentage of RHC procedures by race.
```{r}
## Percentage of RHC by race
rhc_clean |> 
  group_by(race, swang1) |> 
  summarize(count = n()) |> 
  group_by(race) |> 
  mutate(percent = count / sum(count) * 100) |> 
  ungroup() |> 
  filter(swang1 == "RHC") |> 
  select(race, percent)
```

These findings suggest a potential variation in RHC utilization among different racial groups, with the other racial category having the highest percentage of RHC procedures. Further research would be needed to fully understand and check the underlying reasons for these variations.


## Income

Following plot provides insights into the mortality rates across different patients' incomes.
```{r}
#Death by income
rhc_clean |> 
  ggplot(aes(x = income, 
             fill=factor(death))) +
  geom_bar() +
  labs(title = "Death by Income",
       x = "Income",
       y = "Number of patients",
       fill = "Death") +
  scale_fill_manual(name= "Death", values = c("0" = "blue", "1" = "red")) +
  theme_minimal()
```

The following chunk is a representation of the percentage of deaths by income.
```{r}
## Percentage of death by income
rhc_clean |> 
  group_by(income, death) |> 
  summarize(count = n()) |> 
  group_by(income) |> 
  mutate(percent = count / sum(count) * 100) |> 
  ungroup() |> 
  filter(death == 1) |> 
  select(income, percent)
```

This suggest that the lowest income category have the highest percentage of deaths. However, it is important to note that the differences are relatively small and may not be statistically significant. Further research would be needed to fully understand and check the underlying reasons for these variations.


```{r}
# Count of RHC by income
rhc_clean |> 
  ggplot(aes(x = income, 
             fill = as.factor(swang1))) +
  geom_bar() +
  labs(title = "Distribution of Income by RHC Status",
       x = "Income",
       y = "Number of patients",
       fill = "RHC Status") +
  scale_fill_manual(name= "RHC Status", values = c("No RHC" = "blue", "RHC" = "red")) +
  theme_minimal()
```

The following chunk shows the corresponding percentage of RHC procedures by income.
```{r}
## Percentage of RHC by income
rhc_clean |> 
  group_by(income, swang1) |> 
  summarize(count = n()) |> 
  group_by(income) |> 
  mutate(percent = count / sum(count) * 100) |> 
  ungroup() |> 
  filter(swang1 == "RHC") |> 
  select(income, percent)
```

This suggests that patients with higher incomes may have better access to healthcare facilities and may be more likely to undergo diagnostic procedures like RHC. Further research would be needed to fully understand and check the underlying reasons for these variations.



## Education

We create a new variable called "edu_group" based on the "edu" variable, allowing for the grouping of individuals into specific years of education ranges.
```{r}
# Create the variable 'edu_group' 
rhc_clean <- rhc_clean |> 
  mutate(edu_group = cut(edu,
                         breaks = c(-Inf, 10, 20, Inf), 
                         labels = c("<10 years", "between 10-20 years", ">20 years"),
                         include.lowest = TRUE,
                         na.rm = TRUE))
```


Following plot provides insights into the mortality rates across different education groups.
```{r}
# Death in different group of education
rhc_clean |>
  ggplot(aes(x = edu_group, 
             fill=factor(death))) +
  geom_bar() +
  labs(title = "Death by Education",
       x = "Years of eduaction",
       y = "Number of patients") +
  scale_fill_manual(name= "Death", values = c("0" = "blue", "1" = "red")) +
  theme_minimal()
```

The following chunk is a representation of the percentage of deaths by education.
```{r}
## Percentage of death by education
rhc_clean |> 
  group_by(edu_group, death) |> 
  summarize(count = n()) |> 
  group_by(edu_group) |> 
  mutate(percent = count / sum(count) * 100) |> 
  ungroup() |> 
  filter(death == 1) |> 
  select(edu_group, percent)
```

Individuals with higher education levels have slightly higher percentages of deaths. It is possible that individuals with higher education levels may have a higher likelihood of seeking medical attention and being diagnosed with underlying health conditions, which could contribute to the observed higher mortality rates. Further research would be needed to fully understand and check the underlying reasons for these variations.


Following plot provides insights into the RHC appliance rates across different education levels.
```{r}
# Count of RHC by Education
rhc_clean |> 
  ggplot(aes((x = edu_group), 
             fill = as.factor(swang1))) +
  geom_bar() +
  labs(title = "Distribution of Education by RHC Status",
       x = "Education",
       y = "Number of patients",
       fill = "RHC Status") +
  scale_fill_manual(name= "RHC Status", values = c("No RHC" = "blue", "RHC" = "red")) +
  theme_minimal()

```

The following chunk shows the corresponding percentage of RHC procedures by Education.
```{r}
## Percentage of RHC by education
rhc_clean |> 
  group_by(edu_group, swang1) |> 
  summarize(count = n()) |> 
  group_by(edu_group) |> 
  mutate(percent = count / sum(count) * 100) |> 
  ungroup() |> 
  filter(swang1 == "RHC") |> 
  select(edu_group, percent)
```

Individuals with higher education levels have slightly higher percentages of RHC procedures. They may have better access to healthcare, increased health literacy, and a greater understanding of the benefits of diagnostic procedures like RHC. So healthcare providers may be more likely to recommend RHC to patients with higher education levels. Further research would be needed to fully understand and check the underlying reasons for these variations.


## Medical assurance

Following plot provides insights into the mortality rates across different medical assurance.
```{r}
#Death by medical assurance
rhc_clean |> 
  ggplot(aes(x = ninsclas, 
             fill=factor(death))) +
  geom_bar() +
  labs(title = "Death in medical assurance",
       x = "Medical assurance",
       y = "Number of patients",
       fill = "Death") +
  scale_fill_manual(name= "Death", values = c("0" = "blue", "1" = "red")) +
  theme_minimal()
  
```

The following chunk is a representation of the percentage of deaths by medical assurance.
```{r}
## Percentage of DEATH by medical assurance
rhc_clean |> 
  group_by(ninsclas, death) |> 
  summarize(count = n()) |> 
  group_by(ninsclas) |> 
  mutate(percent = count / sum(count) * 100) |> 
  ungroup() |> 
  filter(death == 1) |> 
  select(ninsclas, percent)
```
Individuals covered by Medicare having the highest percentage of deaths.




```{r}
# Count of RHC by Medical Assurance
rhc_clean |> 
  ggplot(aes((x = ninsclas), 
             fill = as.factor(swang1))) +
  geom_bar() +
  labs(title = "Distribution of Medical assurance by RHC Status",
       x = "Medical assurance",
       y = "Count",
       fill = "RHC Status")

```

```{r}
## Percentage of RHC/No RHC by medical assurance
rhc_clean |> 
  group_by(ninsclas, as.factor(swang1)) |> 
  summarize(count = n()) |> 
  group_by(ninsclas) |> 
  mutate(percent = count / sum(count) * 100)
```


## Others


```{r}
# FELIX :)


rhc_clean |>
  # filter(death == 0) |> 
  ggplot(aes(x = income, 
             fill = as.factor(death))) +
  geom_bar(position = "dodge") +
  labs(title = "Death Count by Income and Medical Assurance",
       x = "Income",
       y = "Number of patients",
       fill = "Death status") +
  facet_wrap(~ninsclas) +
  # scale_fill_manual(values = c("red", "blue")) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
# Bar plot for RHC by income and race

rhc_clean |>
  # filter(swang1 == 'RHC') |> 
  ggplot(aes(x = race,
             fill = as.factor(swang1))) +
  geom_bar(position = "dodge") +
  labs(title = "RHC Count by Income and Race",
       x = "Income",
       y = "Number of patients") +
  facet_wrap(~income) +
  theme_minimal() +
  # scale_fill_manual(values = c("red", "blue")) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
# Bar plot for RHC by income and medical assurance
rhc_clean |>
  ggplot(aes(x = race,
             fill = as.factor(swang1),
             group = as.factor(income))) +
  geom_bar(position = "dodge") +
  labs(title = "RHC Count by Income and Medical Assurance",
       x = "Income",
       y = "Count",
       fill = "RHC status") +
  facet_wrap(~income) +
  theme_minimal() +
  scale_fill_manual(values = c("red", "blue")) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```


## FINAL PLOTS (ones in the presentation)






